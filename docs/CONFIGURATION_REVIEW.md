# å¾®å‰ç«¯é…ç½®æŒ‡å—

## ğŸ¯ ç›®æ ‡

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†mf-shellé¡¹ç›®çš„å¾®å‰ç«¯é…ç½®æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–¹æ³•ã€å˜é‡è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹ã€‚

## âœ… å·²å®Œæˆçš„é…ç½®åŒ–æ”¹é€ 

### 1. å¾®å‰ç«¯ç³»ç»Ÿé…ç½®åŒ–

**é…ç½®æ–‡ä»¶ç»“æ„:**

```
src/config/
â”œâ”€â”€ microsystems.dev.ts    # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ microsystems.prod.ts   # ç”Ÿäº§ç¯å¢ƒé…ç½®
â””â”€â”€ microsystems.ts        # é…ç½®ç®¡ç†å™¨
```

**é…ç½®å†…å®¹:**

- åº”ç”¨åç§°ã€æ˜¾ç¤ºåç§°ã€æè¿°
- ä¸»æœºåœ°å€å’Œè¿œç¨‹å…¥å£
- è·¯ç”±è·¯å¾„å’Œæƒé™é…ç½®
- èœå•é¡ºåºå’Œåˆ†ç±»
- å›¾æ ‡é…ç½®
- è·¯ç”±æ¨¡å—è·¯å¾„ (routeModule)

### 2. Module Federation é…ç½®åŠ¨æ€ç”Ÿæˆ

**æ–‡ä»¶:** `module-federation.config.ts`

- âœ… ä»é…ç½®ç³»ç»ŸåŠ¨æ€ç”Ÿæˆ remotes é…ç½®
- âœ… æ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
- âŒ ç§»é™¤ç¡¬ç¼–ç çš„åº”ç”¨åˆ—è¡¨

### 3. è·¯ç”±ç³»ç»Ÿé…ç½®åŒ–

**æ–‡ä»¶:** `src/App.tsx`

- âœ… åŠ¨æ€ç”Ÿæˆå¾®å‰ç«¯è·¯ç”±
- âœ… åŸºäºé…ç½®ç³»ç»Ÿçš„è·¯ç”±ä¿æŠ¤
- âŒ ç§»é™¤ç¡¬ç¼–ç è·¯ç”±è·¯å¾„

### 4. èœå•ç³»ç»Ÿé…ç½®åŒ–

**æ–‡ä»¶:** `src/components/Layout.tsx`

- âœ… åŠ¨æ€ç”Ÿæˆèœå•é¡¹
- âœ… åŸºäºæƒé™çš„èœå•æ˜¾ç¤º
- âœ… åŠ¨æ€è·¯ç”±çŠ¶æ€ç®¡ç†
- âœ… é…ç½®åŒ–çš„é»˜è®¤è·¯ç”±fallback
- âŒ ç§»é™¤ç¡¬ç¼–ç åº”ç”¨åç§°å’ŒURL

### 5. å¾®å‰ç«¯åŠ è½½å™¨é…ç½®åŒ–

**æ–‡ä»¶:** `src/components/MicroFrontendLoader.tsx`

- âœ… ä»é…ç½®ç³»ç»Ÿè·å–åº”ç”¨ä¿¡æ¯
- âœ… åŠ¨æ€å›¾æ ‡æ˜ å°„
- âœ… é…ç½®åŒ–çš„åº”ç”¨æè¿°

## ğŸ”§ é…ç½®ç®¡ç†å™¨åŠŸèƒ½

**ç±»:** `MicrosystemManager`

**æ ¸å¿ƒæ–¹æ³•:**

- `getEnabledMicrosystems()` - è·å–å¯ç”¨çš„å¾®å‰ç«¯
- `getMicrosystem(name)` - è·å–æŒ‡å®šå¾®å‰ç«¯é…ç½®
- `getAccessibleMicrosystems(permissions)` - è·å–ç”¨æˆ·å¯è®¿é—®çš„å¾®å‰ç«¯
- `generateModuleFederationRemotes()` - ç”ŸæˆModule Federationé…ç½®
- `getMenuConfig(permissions)` - ç”Ÿæˆèœå•é…ç½®
- `hasPermission(name, permissions)` - æƒé™æ£€æŸ¥

## ğŸ›¡ï¸ é…ç½®éªŒè¯ç³»ç»Ÿ

**æ–‡ä»¶:** `src/utils/configValidator.ts`

**éªŒè¯å†…å®¹:**

- å¿…å¡«å­—æ®µå®Œæ•´æ€§æ£€æŸ¥
- URLæ ¼å¼éªŒè¯
- è·¯ç”±å†²çªæ£€æµ‹
- ç«¯å£å†²çªæ£€æµ‹ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- èœå•é¡ºåºéªŒè¯
- æƒé™é…ç½®æ£€æŸ¥

**è‡ªåŠ¨éªŒè¯:**

- å¼€å‘ç¯å¢ƒå¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
- æ§åˆ¶å°è¾“å‡ºè¯¦ç»†éªŒè¯ç»“æœ

## ğŸ“‹ é…ç½®ç¤ºä¾‹

### æ·»åŠ æ–°çš„å¾®å‰ç«¯ç³»ç»Ÿ

**1. åœ¨å¼€å‘ç¯å¢ƒé…ç½®ä¸­æ·»åŠ :**

```typescript
// src/config/microsystems.dev.ts
export const devMicrosystems = {
  // ç°æœ‰é…ç½®...

  newSystem: {
    name: 'newSystem',
    displayName: 'æ–°ç³»ç»Ÿ',
    description: 'æ–°çš„å¾®å‰ç«¯ç³»ç»Ÿ',
    icon: 'AppstoreOutlined',
    host: 'http://localhost:3004',
    remoteEntry: 'http://localhost:3004/remoteEntry.js',
    route: '/new-system',
    routeModule: 'newSystem/routes', // è·¯ç”±æ¨¡å—è·¯å¾„
    enabled: true,
    permissions: ['newSystem:read'],
    menuOrder: 4,
    category: 'business',
  },
};
```

**2. åœ¨ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸­æ·»åŠ :**

```typescript
// src/config/microsystems.prod.ts
export const prodMicrosystems = {
  // ç°æœ‰é…ç½®...

  newSystem: {
    name: 'newSystem',
    displayName: 'æ–°ç³»ç»Ÿ',
    description: 'æ–°çš„å¾®å‰ç«¯ç³»ç»Ÿ',
    icon: 'AppstoreOutlined',
    host: 'https://your-domain.com/mf-new-system',
    remoteEntry: 'https://your-domain.com/mf-new-system/remoteEntry.js',
    route: '/new-system',
    enabled: true,
    permissions: ['newSystem:read'],
    menuOrder: 4,
    category: 'business',
  },
};
```

**3. æ— éœ€ä¿®æ”¹ä»»ä½•å…¶ä»–ä»£ç ï¼**

## ğŸš« å·²ç§»é™¤çš„ç¡¬ç¼–ç 

### 1. å¸¸é‡æ–‡ä»¶æ¸…ç†

**æ–‡ä»¶:** `src/constants/index.ts`

- âŒ ç§»é™¤ `MICRO_APPS` ç¡¬ç¼–ç é…ç½®
- âŒ ç§»é™¤ç¡¬ç¼–ç è·¯ç”±è·¯å¾„
- âœ… ä¿ç•™é€šç”¨å¸¸é‡ï¼ˆä¸»é¢˜ã€å¸ƒå±€ç­‰ï¼‰

### 2. Layoutç»„ä»¶æ¸…ç†

- âŒ ç§»é™¤ç¡¬ç¼–ç åº”ç”¨åç§° (`marketing`, `finance`, `template`)
- âŒ ç§»é™¤ç¡¬ç¼–ç URLå’Œç«¯å£
- âŒ ç§»é™¤ç¡¬ç¼–ç è·¯ç”±è·¯å¾„æ£€æŸ¥
- âŒ ç§»é™¤ç¡¬ç¼–ç æƒé™æ£€æŸ¥

### 3. Module Federationæ¸…ç†

- âŒ ç§»é™¤ç¡¬ç¼–ç çš„remotesé…ç½®
- âœ… æ”¹ä¸ºä»é…ç½®ç³»ç»ŸåŠ¨æ€ç”Ÿæˆ

## ğŸ” é…ç½®éªŒè¯ç»“æœç¤ºä¾‹

```
ğŸ” å¾®å‰ç«¯é…ç½®éªŒè¯ç»“æœ
  âœ… é…ç½®éªŒè¯é€šè¿‡

  âš ï¸ è­¦å‘Š:
    â€¢ å¾®å‰ç«¯ template: æ²¡æœ‰é…ç½®æƒé™è¦æ±‚
    â€¢ å­˜åœ¨é‡å¤çš„èœå•é¡ºåºï¼Œå¯èƒ½å½±å“èœå•æ˜¾ç¤ºé¡ºåº
```

## ğŸ“ˆ é…ç½®åŒ–å¸¦æ¥çš„ä¼˜åŠ¿

1. **é›¶ä»£ç æ·»åŠ å¾®å‰ç«¯** - åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶
2. **ç¯å¢ƒéš”ç¦»** - å¼€å‘/ç”Ÿäº§ç¯å¢ƒç‹¬ç«‹é…ç½®
3. **æƒé™æ§åˆ¶** - åŸºäºé…ç½®çš„ç»†ç²’åº¦æƒé™ç®¡ç†
4. **è‡ªåŠ¨éªŒè¯** - é…ç½®é”™è¯¯æ—©æœŸå‘ç°
5. **ç±»å‹å®‰å…¨** - TypeScriptç±»å‹æ£€æŸ¥
6. **æ˜“äºç»´æŠ¤** - é›†ä¸­åŒ–é…ç½®ç®¡ç†

## ç›¸å…³æ–‡æ¡£

- [ç¯å¢ƒé…ç½®æŒ‡å—](./ENVIRONMENT_CONFIG.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)
- [å¼€å‘è§„èŒƒ](./DEV_STANDARDS.md)
